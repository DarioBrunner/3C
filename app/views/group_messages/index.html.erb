<p id="notice"><%= notice %></p>
<div class="jumbotron jumbo-main-content">

  <h1>Group Messages</h1><%= link_to 'New Group Message', new_group_message_path, class: 'btn btn-primary pull-right' %>

  <table class="table">

    <thead>
    <tr>
      <th>Group</th>
      <th>Message</th>
      <th colspan="3"></th>
    </tr>
    </thead>

    <tbody>
    <% @group_messages.each do |group_message| %>
      <tr>
        <% if current_user.groups.include?(group_message.group) %>
          <td><%= group_message.group.title %></td>
          <td>
            <pre><%= group_message.context %><br><br><small>Writer: <%= group_message.creator.name %></small></pre>
          </td>
          <td><%= link_to 'Show', group_message, class: 'btn btn-default' %></td>
          <% if current_user.id == group_message.creator_id %>
            <tr>
              <td></td>
              <td><%= link_to 'Edit', edit_group_message_path(group_message), class: 'btn' %></td>
              <td><%= link_to 'Destroy', group_message, method: :delete, data: {confirm: 'Are you sure?'}, class: 'btn' %></td>
              <td></td>
              <td></td>
              <td>
            </tr>
          <% end %>
          <!---dropdown comments----------->

          <tr>
            <td><strong>Comments:</strong></td>
            <td>
              <% if group_message.group_comments.count != 0 %>
                <a href="#<%= group_message.id %>" class="btn btn-default btn-block" data-toggle="collapse">
                  <span class="badge new-message"><%= group_message.group_comments.count %></span>
                  Comments&nbsp;&nbsp;<span class="caret"></span></a>
                <div id="<%= group_message.id %>" class="collapse">
                  <!---all comments------------->
                  <% group_message.group_comments.each do |comment| %>
                    <% if current_user.id == comment.user_id %>
                  <pre><%= link_to 'Edit', edit_group_comment_path(comment) %> <%= link_to 'Destroy', comment, method: :delete, data: {confirm: 'Are you sure?'} %>
                    <br><%= comment.comment %>
                    <br><small>Written by: <%= comment.user.name %></small>
                  </pre>
                    <% else %>
                      <pre><br><%= comment.comment %>
                        <br><small>Written by: <%= comment.user.name %></small>
                      </pre>
                    <% end %>
                  <% end %>
                </div>
              <% else %>
                <a href="#<%= group_message.id %>" class="btn btn-default btn-block" data-toggle="collapse">
                  <span class="badge">0</span>
                  Comments&nbsp;&nbsp;</a>
              <% end %>
            </td>
            <td><%= link_to 'Add', new_group_comment_path, class: 'btn btn-default' %></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>

        <% end %>
        </tr>
    <% end %>
    </tbody>
  </table>

  <br>


</div>

